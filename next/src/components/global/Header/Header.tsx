import sanityFetch from '@/utils/sanity.fetch';
import Markdown from '@/components/ui/markdown';
import Img, { ImgDataQuery } from '@/components/ui/image';
import styles from './Header.module.scss';
import SocialMedia from './SocialMedia';
import _Header from './_Header';
import type { HeaderQueryTypes } from './Header.types';

export default async function Header() {
  const { nav, nav: { links }, socials } = await query();
  const _links = links.map(({ links, ...props }) => ({
    ...links && {
      links: links.map(({ img, ...props }) => ({
        img: <Img data={img} sizes='32px' style={{ width: 32, height: 32 }} />,
        ...props,
      })),
    },
    ...props,
  }));

  return (
    <>
      <a
        href='#main'
        className={styles.skipToMainContent}
      >
        Przejdź do głównej treści
      </a>
      {nav?.annotation && (
        <aside className={styles['Annotation']}>
          <div className={`${styles.maxWidth} max-width`}>
            <Markdown.p>{nav.annotation}</Markdown.p>
            <SocialMedia data={socials} />
          </div>
        </aside>
      )}
      <_Header
        logo={FoodPatkaLogo}
        links={_links}
        DropdownIcon={<DropdownIcon className={styles.DropdownIcon} />}
        IndicatorIcon={<IndicatorIcon className={styles.IndicatorIcon} />}
        BackIcon={<BackIcon className={styles.BackIcon} />}
      />
    </>
  );
}

const query = async (): Promise<HeaderQueryTypes> => {
  return await sanityFetch<HeaderQueryTypes>({
    query: /* groq */ `
      *[_id == 'global'][0] {
        nav {
          annotation,
          links[] {
            name,
            href,
            links[] {
              name,
              href,
              img {
                ${ImgDataQuery}
              }
            },
          },
        },
        socials {
          instagram,
          youtube,
          tiktok,
        },
      }
    `,
    tags: ['global'],
  });
};

const FoodPatkaLogo = (
  <svg
    xmlns="http://www.w3.org/2000/svg"
    width={256}
    height={46}
    viewBox='0 0 256 46'
    fill="none"
  >
    <path
      d="m24.753 24.48-8.825 8.512a.538.538 0 0 1-.774-.746l8.204-9.124a.504.504 0 0 0-.718-.705l-8.914 8.36a.573.573 0 0 1-.807-.812l8.382-8.867a.5.5 0 0 0-.011-.702.504.504 0 0 0-.693-.014L9.837 30.22c-.53.535-1.506 1.39-1.417 3.175.089 1.785.421 2.254-.715 3.404L0 43.824c.593.812 1.192 1.58 2.071 2.176l7.042-7.81c1.153-1.167 2.016-.843 3.563-.585 1.547.258 2.562-1.114 3.024-1.583l9.74-10.882a.474.474 0 0 0-.02-.654.48.48 0 0 0-.665-.006h-.002Z"
      fill="#C7BECA"
    />
    <path
      d="M35.382 26.745a11.09 11.09 0 0 1-2.753-.371c-3.998-1.029-9.171-4.528-10.588-11.004-.538-2.465-.482-4.86.12-7.009-3.228.344-5.912 1.855-7.625 4.372-2.149 3.155-2.243 7.292-.247 10.793a.44.44 0 0 1-.762.436c-2.165-3.799-2.057-8.29.283-11.722 1.901-2.792 5.001-4.467 8.639-4.774.67-1.844 1.766-3.472 3.249-4.75C28.81.033 32.989-.597 37.162.986l.042.017c.931.466 3.404 1.705 4.186 3.56a.44.44 0 0 1-.81.344c-.651-1.545-2.886-2.673-3.75-3.106C32.972.343 29.124.92 26.27 3.381a10.387 10.387 0 0 0-2.862 4.035c.829-.014 1.683.038 2.553.163 7.004 1.01 12.352 4.763 14.303 10.04 1.093 2.952.86 5.83-.607 7.507-.928 1.062-2.445 1.62-4.272 1.62h-.003ZM23.095 8.295c-.646 2.087-.73 4.45-.197 6.886 1.33 6.089 6.19 9.377 9.947 10.342 2.668.684 5.021.313 6.15-.974 1.236-1.413 1.41-4.014.443-6.626-1.838-4.968-6.923-8.511-13.604-9.473a15.453 15.453 0 0 0-2.74-.155Z"
      fill="#FFB8CE"
    />
    <path
      d="M43.5 7.346c.014-.124.197-.124.21 0l.125 1.048a2.95 2.95 0 0 0 2.581 2.582l1.048.124c.125.014.125.197 0 .21l-1.047.126a2.95 2.95 0 0 0-2.582 2.58l-.124 1.049c-.014.125-.197.125-.211 0l-.125-1.048a2.95 2.95 0 0 0-2.581-2.581l-1.048-.125c-.125-.014-.125-.197 0-.21l1.048-.126a2.95 2.95 0 0 0 2.581-2.58l.125-1.049Z"
      fill="#F489A9"
    />
    <path
      d="M18.093.069c.011-.092.141-.092.152 0l.09.757a2.132 2.132 0 0 0 1.862 1.863l.757.088c.092.011.092.142 0 .153l-.757.089a2.132 2.132 0 0 0-1.863 1.863l-.088.756c-.012.092-.142.092-.153 0l-.089-.756a2.132 2.132 0 0 0-1.863-1.863l-.757-.09c-.091-.01-.091-.14 0-.152l.757-.088A2.132 2.132 0 0 0 18.004.826l.089-.757Z"
      fill="#F489A9"
    />
    <path
      d="M26.496 30.818a1.098 1.098 0 1 0 0-2.196 1.098 1.098 0 0 0 0 2.196Z"
      fill="#F489A9"
    />
    <path
      d="M27.766 13.127c.009-.07.108-.07.117 0l.069.582a1.637 1.637 0 0 0 1.433 1.434l.583.069c.069.008.069.108 0 .116l-.583.07a1.637 1.637 0 0 0-1.433 1.433l-.07.582c-.008.07-.107.07-.116 0l-.069-.582a1.637 1.637 0 0 0-1.433-1.433l-.583-.07c-.069-.008-.069-.108 0-.116l.583-.07a1.637 1.637 0 0 0 1.433-1.433l.07-.582Z"
      fill="#F489A9"
    />
    <path
      d="M45.82 4.643a.762.762 0 1 0 0-1.525.762.762 0 0 0 0 1.525Z"
      fill="#F489A9"
    />
    <path
      d="M58.089 37.99c0 1.026.052 1.863.16 2.512.136.621.405 1.106.81 1.459.405.324.973.554 1.702.687.757.136 1.741.216 2.956.244v1.539H49.38v-1.539c.946-.028 1.703-.108 2.268-.244.594-.136 1.054-.363 1.378-.688.324-.324.54-.781.649-1.377.108-.594.16-1.364.16-2.31V19.401c0-.945-.052-1.702-.16-2.268-.08-.593-.269-1.053-.568-1.378-.27-.352-.674-.58-1.215-.687-.54-.136-1.242-.23-2.107-.283v-1.539h23.408l.446 7.735h-1.416c-.161-1.161-.419-2.107-.768-2.836-.352-.757-.851-1.35-1.497-1.783-.621-.432-1.417-.729-2.39-.89-.973-.188-2.188-.282-3.646-.282h-5.143c-.46 0-.688.23-.688.687v12.23c1.295 0 2.404-.067 3.322-.203.945-.16 1.713-.432 2.31-.81a3.7 3.7 0 0 0 1.416-1.538c.324-.649.527-1.486.607-2.512h1.417V34.91h-1.417c-.136-1.026-.352-1.877-.648-2.55a3.508 3.508 0 0 0-1.337-1.58c-.568-.378-1.309-.65-2.226-.81-.918-.161-2.066-.244-3.444-.244v8.262l-.002.002Z"
      fill="#726378"
    />
    <path
      d="M94.211 29.16a10.358 10.358 0 0 0-2.47-3.485 11.106 11.106 0 0 0-3.605-2.265 11.342 11.342 0 0 0-4.372-.848 11.65 11.65 0 0 0-4.333.806 11.137 11.137 0 0 0-3.563 2.271 10.675 10.675 0 0 0-2.431 3.482c-.593 1.35-.893 2.823-.893 4.417 0 1.594.297 3.172.893 4.577a11.018 11.018 0 0 0 2.431 3.563c1.026 1 2.213 1.782 3.563 2.35 1.378.539 2.822.808 4.333.808 1.511 0 2.995-.283 4.373-.849a11.234 11.234 0 0 0 3.604-2.35 10.618 10.618 0 0 0 2.47-3.563c.621-1.378.931-2.887.931-4.536 0-1.65-.307-3.05-.931-4.372v-.006ZM90.08 37.34c-.324 1.134-.785 2.107-1.378 2.916a6.128 6.128 0 0 1-2.146 1.86c-.837.433-1.769.65-2.794.65-1.026 0-1.947-.217-2.756-.65a6.464 6.464 0 0 1-2.105-1.82c-.568-.81-1.014-1.78-1.336-2.915-.296-1.134-.446-2.403-.446-3.809 0-1.406.15-2.578.446-3.682.322-1.134.768-2.093 1.336-2.875.594-.81 1.298-1.43 2.105-1.863a5.912 5.912 0 0 1 2.756-.649c1 0 1.957.233 2.794.69.838.43 1.553 1.051 2.146 1.861.593.785 1.054 1.73 1.378 2.836.324 1.104.485 2.335.485 3.682 0 1.348-.16 2.631-.485 3.768Z"
      fill="#726378"
    />
    <path
      d="M119.285 29.16a10.361 10.361 0 0 0-2.47-3.485 11.106 11.106 0 0 0-3.604-2.265 11.335 11.335 0 0 0-4.373-.848c-1.538 0-2.955.266-4.333.806a11.16 11.16 0 0 0-3.562 2.271 10.62 10.62 0 0 0-2.43 3.482c-.593 1.35-.892 2.823-.892 4.417 0 1.594.297 3.172.893 4.577.59 1.375 1.4 2.562 2.429 3.563a11.38 11.38 0 0 0 3.562 2.35c1.378.539 2.822.808 4.333.808 1.511 0 3-.283 4.373-.849a11.234 11.234 0 0 0 3.604-2.35 10.622 10.622 0 0 0 2.47-3.563c.621-1.378.934-2.887.934-4.536 0-1.65-.313-3.05-.934-4.372v-.006Zm-4.131 8.179c-.324 1.134-.784 2.107-1.378 2.916a6.12 6.12 0 0 1-2.146 1.86c-.837.433-1.768.65-2.794.65s-1.941-.217-2.753-.65a6.408 6.408 0 0 1-2.107-1.82c-.569-.81-1.012-1.78-1.337-2.915-.296-1.134-.446-2.403-.446-3.809 0-1.406.15-2.578.446-3.682.325-1.134.768-2.093 1.337-2.875.593-.81 1.297-1.43 2.107-1.863a5.9 5.9 0 0 1 2.753-.649 5.8 5.8 0 0 1 2.794.69c.838.43 1.553 1.051 2.146 1.861.594.785 1.054 1.73 1.378 2.836.325 1.104.485 2.335.485 3.682 0 1.348-.16 2.631-.485 3.768Z"
      fill="#726378"
    />
    <path
      d="M145.721 42.928a3.502 3.502 0 0 1-.932-.244 1.642 1.642 0 0 1-.529-.524 4.056 4.056 0 0 1-.283-.81c-.136-.512-.216-1.36-.244-2.55a207.385 207.385 0 0 1-.042-4.616V10.818l-8.303 1.535v1.217c1.405 0 2.417.125 3.038.367.621.244 1.001.66 1.134 1.253.081.377.136 1.08.161 2.107.053 1.023.08 2.31.08 3.845v4.134c-.945-.945-1.929-1.636-2.955-2.068-1.001-.433-2.146-.644-3.443-.644-1.514 0-2.914.283-4.212.849a9.705 9.705 0 0 0-3.363 2.31c-.917.972-1.647 2.145-2.187 3.523-.51 1.35-.768 2.822-.768 4.411 0 1.589.258 3.119.768 4.497.54 1.378 1.27 2.567 2.187 3.563a10.71 10.71 0 0 0 3.319 2.312c1.297.538 2.714.807 4.253.807 1.539 0 2.767-.283 3.848-.849 1.109-.593 2.146-1.577 3.119-2.955h.161v3.806l6.723-.443v-1.378c-.621 0-1.134-.028-1.539-.08l.009-.009Zm-5.994-8.179c0 1.456-.081 2.606-.244 3.444-.161.834-.433 1.552-.81 2.146a4.815 4.815 0 0 1-1.012 1.092 9.333 9.333 0 0 1-1.336.81c-.46.216-.946.377-1.459.485-.485.108-.973.16-1.458.16-.973 0-1.838-.216-2.589-.648-.729-.46-1.351-1.093-1.863-1.902-.486-.837-.865-1.838-1.134-3-.244-1.162-.364-2.454-.364-3.887 0-2.753.499-4.93 1.498-6.518 1.025-1.622 2.509-2.431 4.455-2.431.945 0 1.891.216 2.836.648a5.755 5.755 0 0 1 2.39 1.822c.433.54.715 1.173.848 1.902.161.729.244 1.8.244 3.2v2.675l-.002.002Z"
      fill="#726378"
    />
    <path
      d="M171.826 15.309c-2.024-1.375-4.899-2.066-8.628-2.066h-12.714v1.54c.859.052 1.563.146 2.104.282.541.108.946.34 1.217.69.297.325.485.785.569 1.378.108.563.16 1.32.16 2.265v18.875c0 .943-.052 1.713-.16 2.31-.109.596-.325 1.05-.649 1.375-.325.324-.785.554-1.378.69-.568.136-1.32.216-2.265.244v1.536h14.297v-1.536c-1.217 0-2.204-.053-2.955-.16-.729-.137-1.298-.378-1.702-.73-.377-.352-.632-.837-.768-1.458-.108-.649-.161-1.47-.161-2.47v-7.816h3.643c2.265 0 4.184-.216 5.75-.649 1.594-.432 2.875-1.037 3.848-1.821.995-.785 1.725-1.741 2.185-2.875.46-1.134.69-2.418.69-3.849 0-2.453-1.026-4.372-3.08-5.75l-.003-.005Zm-4.172 11.384c-1.292 1.025-3.294 1.535-5.992 1.535h-2.875v-12.39c0-.46.228-.69.688-.69h3.723c2.216 0 3.837.502 4.86 1.503 1.054.967 1.584 2.606 1.584 4.899s-.663 4.092-1.988 5.145v-.002Z"
      fill="#726378"
    />
    <path
      d="M195.073 41.675c-.244.405-.54.66-.893.768-.352.08-.715.125-1.092.125-1.217 0-1.821-1.539-1.821-4.616v-9.075c0-2.293-.569-3.914-1.703-4.86-1.134-.973-3.049-1.455-5.75-1.455-2.537 0-4.497.363-5.872 1.092-1.378.701-2.065 1.702-2.065 2.994 0 1.292.671 2.027 2.024 2.027.54 0 .945-.125 1.217-.366.296-.266.593-.796.892-1.578.161-.513.325-.945.486-1.297.188-.347.39-.618.607-.807.216-.188.485-.324.809-.405.325-.08.716-.124 1.173-.124 2.811 0 4.211 1.646 4.211 4.94v1.664l-5.827 2.55c-1.217.538-2.243 1.076-3.081 1.617-.837.513-1.513 1.042-2.023 1.577-.513.54-.893 1.11-1.134 1.702a5.392 5.392 0 0 0-.325 1.863c0 1.456.485 2.618 1.459 3.483.967.865 2.309 1.297 4.006 1.297 1.514 0 2.891-.377 4.131-1.134a8.24 8.24 0 0 0 2.916-3.158h.2c0 1.376.286 2.443.854 3.2.593.751 1.483 1.131 2.67 1.131.945 0 1.849-.2 2.714-.607.865-.433 1.458-.957 1.783-1.578l-.569-.973.003.003Zm-7.777-6.033c0 .915-.13 1.794-.402 2.631a7.696 7.696 0 0 1-1.095 2.146 5.48 5.48 0 0 1-1.616 1.417 3.74 3.74 0 0 1-1.946.524c-.973 0-1.755-.283-2.351-.849-.594-.568-.888-1.297-.888-2.187 0-.59.131-1.173.402-1.741.297-.569.771-1.134 1.42-1.7.649-.568 1.497-1.134 2.551-1.702 1.081-.568 2.389-1.145 3.925-1.741v3.202Z"
      fill="#726378"
    />
    <path
      d="M195.608 25.514v-1.497c1.431-.837 2.551-1.674 3.361-2.512.809-.837 1.43-1.835 1.863-2.997h1.175v5.104h5.426v1.905h-5.426V37.83c0 .945.042 1.74.122 2.39.108.648.269 1.175.485 1.58.217.377.499.649.852.81.352.16.795.243 1.336.243.674 0 1.242-.136 1.702-.404.485-.297.959-.782 1.417-1.459l1.012.77c-.377.999-1.04 1.77-1.985 2.31-.918.513-2.066.768-3.444.768-1.782 0-3.144-.418-4.089-1.256-.918-.865-1.378-2.093-1.378-3.684V25.52h-2.429v-.006Z"
      fill="#726378"
    />
    <path
      d="M223.158 43.011c.89 0 1.497-.041 1.822-.122.352-.08.527-.188.527-.324-.028-.216-.244-.607-.649-1.176a36.185 36.185 0 0 0-1.58-2.024l-4.292-5.184-1.497 1.417v2.39c0 1.053.041 1.901.122 2.55.108.621.282 1.12.526 1.497.269.353.649.594 1.134.73.513.135 1.176.216 1.985.243v1.417h-11.503V43.01c.81-.028 1.459-.109 1.944-.245.513-.135.904-.377 1.176-.729.296-.352.499-.823.607-1.416.108-.594.16-1.378.16-2.349V21.303c0-2.052-.027-3.604-.08-4.658-.028-1.053-.161-1.769-.405-2.146-.244-.377-.648-.593-1.214-.649-.568-.08-1.322-.121-2.268-.121V12.35l7.816-1.54v22.233l3.765-3.684a163.998 163.998 0 0 1 2.714-2.673c.593-.593.89-1.04.89-1.336 0-.297-.283-.527-.851-.688-.569-.188-1.378-.283-2.432-.283v-1.416h10.53v1.416c-.513 0-.959.028-1.336.08-.377.053-.743.162-1.093.325-.324.16-.673.391-1.053.688-.377.269-.81.62-1.295 1.053l-5.83 5.185 8.018 9.071c.377.46.715.838 1.012 1.134.324.27.634.485.931.649.324.16.66.283 1.012.366.377.053.823.08 1.336.08v1.417h-10.651v-1.417h.002Z"
      fill="#726378"
    />
    <path
      d="M255.02 41.675c-.244.405-.541.66-.893.768-.352.08-.716.125-1.093.125-1.217 0-1.821-1.539-1.821-4.616v-9.075c0-2.293-.568-3.914-1.702-4.86-1.134-.973-3.05-1.455-5.75-1.455-2.537 0-4.492.363-5.873 1.092-1.377.701-2.065 1.702-2.065 2.994 0 1.292.676 2.027 2.024 2.027.541 0 .945-.125 1.217-.366.297-.266.593-.796.893-1.578.161-.513.324-.945.485-1.297.188-.347.391-.618.607-.807.216-.188.485-.324.81-.405a4.93 4.93 0 0 1 1.172-.124c2.812 0 4.215 1.646 4.215 4.94v1.664l-5.834 2.55c-1.217.538-2.243 1.076-3.08 1.617-.837.513-1.508 1.042-2.024 1.577-.513.54-.893 1.11-1.134 1.702a5.415 5.415 0 0 0-.324 1.863c0 1.456.485 2.618 1.458 3.483.973.865 2.31 1.297 4.006 1.297 1.514 0 2.892-.377 4.134-1.134a8.259 8.259 0 0 0 2.914-3.158h.205c0 1.376.283 2.443.849 3.2.593.751 1.486 1.131 2.669 1.131.946 0 1.852-.2 2.715-.607.865-.433 1.458-.957 1.782-1.578l-.568-.973.006.003Zm-7.774-6.033c0 .915-.136 1.794-.405 2.631a7.723 7.723 0 0 1-1.095 2.146 5.35 5.35 0 0 1-1.617 1.417 3.74 3.74 0 0 1-1.946.524c-.973 0-1.755-.283-2.345-.849-.594-.568-.893-1.297-.893-2.187 0-.59.136-1.173.405-1.741.296-.569.768-1.134 1.416-1.7.649-.568 1.497-1.134 2.551-1.702 1.081-.568 2.39-1.145 3.929-1.741v3.202Z"
      fill="#726378"
    />
  </svg>
);

const DropdownIcon = ({ ...props }) => (
  <svg
    xmlns='http://www.w3.org/2000/svg'
    width={20}
    height={20}
    viewBox='0 0 20 20'
    fill='none'
    {...props}
  >
    <path
      d='m5 8 5 5 5-5'
      stroke='#726378'
      strokeWidth={1.5}
      strokeLinecap='round'
      strokeLinejoin='round'
    />
  </svg>
);

const BackIcon = ({ ...props }) => (
  <svg
    xmlns='http://www.w3.org/2000/svg'
    width={20}
    height={20}
    viewBox='0 0 20 20'
    fill='none'
    {...props}
  >
    <path
      d='m12.5 15-5-5 5-5'
      stroke='#97879D'
      strokeWidth={1.5}
      strokeLinecap='round'
      strokeLinejoin='round'
    />
  </svg>
);

const IndicatorIcon = ({ ...props }) => (
  <svg
    xmlns='http://www.w3.org/2000/svg'
    width={12}
    height={12}
    viewBox='0 0 12 12'
    fill='#F489A9'
    {...props}
  >
    <path d='M5.84.142c.022-.19.298-.19.32 0l.189 1.591a4.476 4.476 0 0 0 3.918 3.918l1.59.189c.19.022.19.298 0 .32l-1.59.189a4.476 4.476 0 0 0-3.918 3.918l-.189 1.59c-.022.19-.298.19-.32 0l-.189-1.59a4.476 4.476 0 0 0-3.918-3.918L.143 6.16c-.19-.022-.19-.298 0-.32l1.59-.189a4.476 4.476 0 0 0 3.918-3.918L5.84.143Z' />
  </svg>
);